from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By
import time

# Read ID and password from a file
try:
    with open("/Users/slver/Documents/CloudTech/VideoStore_1/credentials.txt", "r") as f:
        lines = f.readlines()
        username = lines[0].strip()
        password = lines[1].strip()
except FileNotFoundError:
    print("Credentials file not found. Make sure the file exists.")
    exit(1)

# Initialize WebDriver
try:
    options = webdriver.ChromeOptions()
    driver = webdriver.Chrome(options=options)
except Exception as e:
    print(f"Failed to initialize WebDriver: {e}")
    exit(1)

# Open the website
driver.get("https://cloudtechtr.click/signin")

# Assuming username and password fields have input tags with name attributes "username" and "password"
driver.find_element(By.NAME, "username").send_keys(username)
driver.find_element(By.NAME, "password").send_keys(password)
driver.find_element(By.NAME, "password").send_keys(Keys.RETURN)

# Add a sleep to wait for login to complete
time.sleep(5)

# Validate if login was successful
if "<th>Class No</th>" in driver.page_source:
    print("Login successful")
else:
    print("Login failed")
    driver.quit()
    exit(1)

# Find and click on video links
video_links = driver.find_elements(By.XPATH, "//a[contains(@href, 'video')]")
video_info = []

for video in video_links:
    title = video.text
    video.click()

    # Wait for video to load
    time.sleep(5)

    # Check if video is playing
    video_elements = driver.find_elements(By.TAG_NAME, "video")
    if video_elements:
        video_element = video_elements[0]
        is_paused = driver.execute_script("return arguments[0].paused;", video_element)
        current_time = driver.execute_script("return arguments[0].currentTime;", video_element)

        if not is_paused and current_time > 3:
            video_info.append((title, "Opened"))
        else:
            video_info.append((title, "Failed"))
    else:
        print("No video element found.")
        video_info.append((title, "Failed"))

    # Go back to the previous page
    driver.back()
    time.sleep(3)

# Output the video info
for title, status in video_info:
    print(f"Video: {title}, Status: {status}")

# Validate all videos
if all(status == "Opened" for _, status in video_info):
    print("All OK")
else:
    print("Failed")

# Close the browser
driver.quit()